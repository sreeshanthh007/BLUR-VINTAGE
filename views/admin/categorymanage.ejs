<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Management - BLUR VINTAGE ★</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/styles/categoryManage.css">
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <%-include('../partials/admin/sidebar.ejs')%>

        <!-- Main Content -->
        <main class="main-content w-100">
            <!-- <h1 class="mb-4">BLUR VINTAGE ★</h1> -->

            <!-- Category Table -->
            <div class="category-table mt-5">
                <div class="table-header row align-items-center" >
                    <div class="col-1">S.No</div>
                    <div class="col">Category Name</div>
                    <div class="col-3 text-end">List / Unlist</div>
                </div>

                <!-- Category Items -->
                <div class="category-row row align-items-center">
                    <div class="col-1">1</div>
                    <div class="col">T shirt</div>
                    <div class="col-3 text-end">
                        <label class="toggle-switch me-2">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                        <i class="bi bi-pencil-square"></i>
                    </div>
                </div>

                <div class="category-row row align-items-center">
                    <div class="col-1">2</div>
                    <div class="col">wide leg jeans</div>
                    <div class="col-3 text-end">
                        <label class="toggle-switch me-2">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                        <i class="bi bi-pencil-square"></i>
                    </div>
                </div>

                <div class="category-row row align-items-center">
                    <div class="col-1">3</div>
                    <div class="col">Hoodies</div>
                    <div class="col-3 text-end">
                        <label class="toggle-switch me-2">
                            <input type="checkbox">
                            <span class="slider"></span>
                        </label>
                        <i class="bi bi-pencil-square"></i>
                    </div>
                </div>
            </div>

            <!-- Add New Category Form -->
            <div class="form-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="m-0">Add New Category</h2>
                    <div class="d-flex align-items-center">
                        <span class="me-2">List / Unlist :</span>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <form onsubmit="categoryValidate(e)" method="post" action="/admin/addcategory">
                    <div class="mb-3">
                        <label class="form-label">Name:</label>
                        <input type="text" class="form-control" name="name" id="name">
                        <p class="text-danger error-message"></p>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">Description:</label>
                        <textarea class="form-control" rows="4" name="description" id="description"></textarea>
                        <p class="text-danger error-message"></p>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="save-btn">SAVE</button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>



<script>
    function categoryValidate(e){
        e.preventDefault();

        if(!validateForm()){
            return
        }
        const name = document.getElementById('name')[0].value;
        const description = document.getElementById('description').value;


        fetch("/admin/addcategory",{
            method:"post",
            headers:{
                "content-Type":"application/json"
            },
            body:JSON.stringify({name,description})
        })
        .then(response =>{
            if(!response.ok){
                return response.json().then(err =>{
                    throw new console.error(err);
                    
                })
            }
            return response.json()
        })
        .then(data =>{
            location.reload();
        })
        .catch(error =>{
            if(error.message==="category already exist !"){
                Swal.fire({
                    icon:"error",
                    title:"already exists",
                    text:"try new category"
                })
            }else{
                Swal.fire({
                    icon:"error",
                    title:"error"
                })
            }
        })
    }

    function validateForm(){
        clearErrorMessages();

        const name = document.getElementById('name')[0].value.trim();
        const description = document.getElementById('description').value.trim();
        isValid = true;

        if(name===""){
            displayErrorMessage("name-error","please enter a name")
            isValid=false
        }else if(!/^[a-zA-Z\s]+$/.test(name)){
            displayErrorMessage("name-error","name should only contain alphabetic charaters");
            isValid=false
        }
        if(description===""){
            displayErrorMessage("discription-error","please enter the description");
            isValid=false;
        }
        return isValid;
    }


    function displayErrorMessage(elementId,message){
        let errorElement = document.getElementById(elementId);
        errorElement.innerText = message;
        errorElement.style.display="block";

    }
    function clearErrorMessages(){
        const errorElements = document.getElementsByClassName("error-message")
        Array.from(errorElements).forEach((elm)=>{
            elm.innerText="";
            elm.style.display="none";
        });
    }
</script>